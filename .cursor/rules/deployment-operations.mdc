---
description: 
globs: 
alwaysApply: true
---
# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ»é‹ç”¨ç®¡ç†ãƒ«ãƒ¼ãƒ«

## ğŸš€ Vercel ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥

### ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒè¨­å®š
```typescript
/**
 * Vercelæœ€é©åŒ–è¨­å®šã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹
 * 
 * ğŸ¤” ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥:
 * 1. é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆ vs ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åˆ¤æ–­
 * 2. Edge Functionsæ´»ç”¨ã«ã‚ˆã‚‹å¿œç­”é€Ÿåº¦å‘ä¸Š
 * 3. ç’°å¢ƒå¤‰æ•°ã®å®‰å…¨ãªç®¡ç†æˆ¦ç•¥
 * 4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®æ´»ç”¨
 */

// âœ… vercel.json æœ€é©åŒ–è¨­å®š
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "installCommand": "npm ci",
  "framework": "vite",
  "functions": {
    "src/api/*.ts": {
      "runtime": "nodejs18.x"
    }
  },
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Access-Control-Allow-Origin",
          "value": "*"
        }
      ]
    }
  ]
}
```

### ç’°å¢ƒå¤‰æ•°ç®¡ç†
```typescript
// âœ… æœ¬ç•ªç’°å¢ƒã§ã®ç’°å¢ƒå¤‰æ•°è¨­å®šæ€è€ƒ
/**
 * æ€è€ƒ: ç’°å¢ƒå¤‰æ•°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£éšå±¤åŒ–
 * 1. å…¬é–‹æƒ…å ±: VITE_APP_NAME ãªã©
 * 2. æ©Ÿå¯†æƒ…å ±: API ã‚­ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èªè¨¼æƒ…å ±
 * 3. ç’°å¢ƒåˆ¥è¨­å®š: é–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»æœ¬ç•ªã®åˆ†é›¢
 */

// Vercelç’°å¢ƒå¤‰æ•°è¨­å®š
const requiredEnvVars = [
  'VITE_GROK_API_KEY',      // Grok APIèªè¨¼
  'VITE_SUPABASE_URL',      // Supabaseæ¥ç¶šURL
  'VITE_SUPABASE_ANON_KEY', // SupabaseåŒ¿åã‚­ãƒ¼
] as const;

// ç’°å¢ƒå¤‰æ•°æ¤œè¨¼é–¢æ•°
const validateEnvironmentVariables = () => {
  const missing = requiredEnvVars.filter(
    key => !import.meta.env[key]
  );
  
  if (missing.length > 0) {
    throw new Error(
      `Missing required environment variables: ${missing.join(', ')}`
    );
  }
};
```

## ğŸ”„ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```yaml
# âœ… .github/workflows/deploy.yml
name: Deploy to Vercel

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run type check
        run: npm run type-check
        
      - name: Run tests
        run: npm run test:coverage
        
      - name: Run E2E tests
        run: npm run test:e2e
        
      - name: Build application
        run: npm run build
        
      - name: Deploy to Vercel
        if: github.ref == 'refs/heads/main'
        uses: vercel/action@v1
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
```typescript
/**
 * ãƒ‡ãƒ—ãƒ­ã‚¤å‰å“è³ªã‚²ãƒ¼ãƒˆ
 * 
 * å¿…é ˆãƒã‚§ãƒƒã‚¯é …ç›®:
 * 1. TypeScriptå‹ãƒã‚§ãƒƒã‚¯æˆåŠŸ
 * 2. 95%ä»¥ä¸Šãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
 * 3. Lighthouse ã‚¹ã‚³ã‚¢ 90ç‚¹ä»¥ä¸Š
 * 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
 * 5. ç’°å¢ƒå¤‰æ•°è¨­å®šç¢ºèª
 */

const deploymentChecklist = {
  typeCheck: () => runCommand('npm run type-check'),
  testCoverage: () => runCommand('npm run test:coverage'),
  lighthouseScore: () => runCommand('npm run lighthouse'),
  securityScan: () => runCommand('npm audit'),
  envValidation: () => validateEnvironmentVariables(),
} as const;
```

## ğŸ“Š ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»ãƒ­ã‚°ç®¡ç†

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
```typescript
/**
 * æœ¬ç•ªç’°å¢ƒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹
 * 
 * ğŸ” ç›£è¦–å¯¾è±¡:
 * 1. Core Web Vitals (LCP, FID, CLS)
 * 2. API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“
 * 3. ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡
 * 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æ
 */

// âœ… Real User Monitoring (RUM) å®Ÿè£…
const initializeRUM = () => {
  // Web Vitals æ¸¬å®š
  import('web-vitals').then(({ getCLS, getFID, getLCP }) => {
    getCLS(console.log);
    getFID(console.log);
    getLCP(console.log);
  });
  
  // ã‚¨ãƒ©ãƒ¼è¿½è·¡
  window.addEventListener('error', (event) => {
    console.error('Runtime Error:', {
      message: event.message,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    });
  });
};
```

### ã‚¨ãƒ©ãƒ¼è¿½è·¡ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
```typescript
// âœ… ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°é›†ç´„ã‚·ã‚¹ãƒ†ãƒ 
/**
 * æ€è€ƒ: ã‚¨ãƒ©ãƒ¼åˆ†é¡ã¨ã‚¢ãƒ©ãƒ¼ãƒˆæˆ¦ç•¥
 * 1. ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚¨ãƒ©ãƒ¼ â†’ å³åº§ã«ã‚¢ãƒ©ãƒ¼ãƒˆ
 * 2. ä¸€èˆ¬çš„ã‚¨ãƒ©ãƒ¼ â†’ æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
 * 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ– â†’ é€±æ¬¡åˆ†æ
 */

interface ErrorLog {
  level: 'error' | 'warn' | 'info';
  message: string;
  stack?: string;
  userAgent: string;
  url: string;
  timestamp: Date;
  userId?: string;
}

const logError = (error: Error, context: Partial<ErrorLog>) => {
  const errorLog: ErrorLog = {
    level: 'error',
    message: error.message,
    stack: error.stack,
    userAgent: navigator.userAgent,
    url: window.location.href,
    timestamp: new Date(),
    ...context,
  };
  
  // Supabase ã«é€ä¿¡ï¼ˆéåŒæœŸï¼‰
  supabase.from('error_logs').insert(errorLog);
};
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‹ç”¨

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
```typescript
// âœ… vercel.json ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
/**
 * æ€è€ƒ: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®å¿…è¦æ€§
 * 1. XSSæ”»æ’ƒé˜²æ­¢ â†’ Content-Security-Policy
 * 2. ã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚­ãƒ³ã‚°é˜²æ­¢ â†’ X-Frame-Options
 * 3. HTTPSå¼·åˆ¶ â†’ Strict-Transport-Security
 */

const securityHeaders = [
  {
    "key": "X-DNS-Prefetch-Control",
    "value": "on"
  },
  {
    "key": "Strict-Transport-Security",
    "value": "max-age=63072000; includeSubDomains; preload"
  },
  {
    "key": "X-Content-Type-Options",
    "value": "nosniff"
  },
  {
    "key": "X-Frame-Options",
    "value": "DENY"
  },
  {
    "key": "X-XSS-Protection",
    "value": "1; mode=block"
  },
  {
    "key": "Referrer-Policy",
    "value": "origin-when-cross-origin"
  }
];
```

### å®šæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
```typescript
// âœ… è‡ªå‹•ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
/**
 * é€±æ¬¡å®Ÿè¡Œã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
 * 
 * ãƒã‚§ãƒƒã‚¯é …ç›®:
 * 1. ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
 * 2. API ã‚­ãƒ¼ã®æœ‰åŠ¹æœŸé™ç¢ºèª
 * 3. ä¸å¯©ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º
 * 4. HTTPSè¨¼æ˜æ›¸æœ‰åŠ¹æ€§ç¢ºèª
 */

const securityAudit = {
  vulnerabilityScan: () => runCommand('npm audit --audit-level high'),
  dependencyCheck: () => runCommand('npm outdated'),
  apiKeyValidation: async () => {
    // Grok API ã‚­ãƒ¼æœ‰åŠ¹æ€§ç¢ºèª
    const isValidGrokKey = await validateGrokApiKey();
    return { grokApi: isValidGrokKey };
  },
  httpsCheck: () => {
    // SSLè¨¼æ˜æ›¸ç¢ºèª
    return fetch(window.location.origin).then(res => res.ok);
  },
};
```

## ğŸ“ˆ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æˆ¦ç•¥

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
```typescript
/**
 * ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ™‚ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹
 * 
 * ğŸ¯ æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ:
 * 1. CDNæ´»ç”¨ã«ã‚ˆã‚‹é™çš„ã‚¢ã‚»ãƒƒãƒˆé…ä¿¡
 * 2. ã‚³ãƒ¼ãƒ‰åˆ†å‰²ã«ã‚ˆã‚‹åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“çŸ­ç¸®
 * 3. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã®æœ€é©åŒ–
 * 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæœ€é©åŒ–
 */

// âœ… ã‚³ãƒ¼ãƒ‰åˆ†å‰²æˆ¦ç•¥
const lazyLoadComponents = {
  EpubReader: lazy(() => import('@/components/Reader/EpubReader')),
  ChatContainer: lazy(() => import('@/components/Chat/ChatContainer')),
  AdvancedSettings: lazy(() => import('@/components/Settings/AdvancedSettings')),
};

// âœ… é™çš„ã‚¢ã‚»ãƒƒãƒˆæœ€é©åŒ–
const optimizeAssets = {
  images: 'WebPå½¢å¼ã§ã®é…ä¿¡ã€é©åˆ‡ãªã‚µã‚¤ã‚ºèª¿æ•´',
  fonts: 'ãƒ•ã‚©ãƒ³ãƒˆè¡¨ç¤ºã®æœ€é©åŒ–ã€ã‚µãƒ–ã‚»ãƒƒãƒˆåŒ–',
  scripts: 'Tree shakingã€ã‚³ãƒ¼ãƒ‰åˆ†å‰²',
  styles: 'Critical CSS ã®æŠ½å‡º',
};
```

### ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°
```typescript
/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼å¢—åŠ ã«å¯¾ã™ã‚‹è¨ˆç”»çš„å¯¾å¿œ
 * 
 * ğŸ”„ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æŒ‡æ¨™:
 * 1. åŒæ™‚æ¥ç¶šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
 * 2. APIå‘¼ã³å‡ºã—é »åº¦
 * 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è² è·
 * 4. CDNè»¢é€é‡
 */

const scalingThresholds = {
  concurrentUsers: 1000,     // åŒæ™‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ä¸Šé™
  apiCallsPerMinute: 10000,  // APIå‘¼ã³å‡ºã—é »åº¦
  databaseConnections: 100,  // DBæ¥ç¶šæ•°ä¸Šé™
  cdnBandwidth: '1TB/month', // CDNè»¢é€é‡ä¸Šé™
} as const;
```

---

**é‡è¦**: æœ¬ç•ªç’°å¢ƒã§ã¯å¸¸ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€å„ªå…ˆã«è€ƒãˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ä¿è­·ã¨æœ€é©ãªä½“é¨“ã®æä¾›ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
